<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H·ªçc T·ª´ V·ª±ng - Cloud Storage</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap');
        
        * {
            font-family: 'Poppins', sans-serif;
        }
        
        @keyframes fade-in {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slide-up {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .animate-fade-in {
            animation: fade-in 0.8s ease;
        }
        
        .animate-slide-up {
            animation: slide-up 0.6s ease;
        }
        
        .perspective-1000 {
            perspective: 1000px;
        }
        
        .transform-style-3d {
            transform-style: preserve-3d;
        }
        
        .backface-hidden {
            backface-visibility: hidden;
        }
        
        .rotate-y-180 {
            transform: rotateY(180deg);
        }
        
        .transition-transform {
            transition: transform 0.5s;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Lucide Icons as SVG components
        const BookOpen = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
            </svg>
        );

        const Upload = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
            </svg>
        );

        const Plus = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
            </svg>
        );

        const Trash2 = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
            </svg>
        );

        const Volume2 = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" />
            </svg>
        );

        const ChevronLeft = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7" />
            </svg>
        );

        const ChevronRight = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" />
            </svg>
        );

        const Sparkles = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" />
            </svg>
        );

        const VocabApp = () => {
            const [vocabSets, setVocabSets] = useState([]);
            const [activeSetId, setActiveSetId] = useState(null);
            const [currentIndex, setCurrentIndex] = useState(0);
            const [isFlipped, setIsFlipped] = useState(false);
            const [showUpload, setShowUpload] = useState(false);
            const [loading, setLoading] = useState(true);
            const [syncing, setSyncing] = useState(false);
            
            const [setName, setSetName] = useState('');
            const [excelFile, setExcelFile] = useState(null);
            const [audioFiles, setAudioFiles] = useState([]);
            
            const audioRef = useRef(new Audio());

            useEffect(() => {
                loadFromCloud();
            }, []);

            const loadFromCloud = async () => {
                setLoading(true);
                try {
                    const result = await window.storage.list('vocabset:', true);
                    if (result && result.keys) {
                        const sets = [];
                        for (const key of result.keys) {
                            try {
                                const data = await window.storage.get(key, true);
                                if (data && data.value) {
                                    const set = JSON.parse(data.value);
                                    sets.push(set);
                                }
                            } catch (err) {
                                console.log('Key not found:', key);
                            }
                        }
                        setVocabSets(sets.sort((a, b) => b.id - a.id));
                    }
                } catch (error) {
                    console.log('Loading from cloud...');
                }
                setLoading(false);
            };

            const saveSetToCloud = async (set) => {
                setSyncing(true);
                try {
                    await window.storage.set(`vocabset:${set.id}`, JSON.stringify(set), true);
                } catch (error) {
                    alert('L·ªói khi l∆∞u l√™n cloud: ' + error.message);
                }
                setSyncing(false);
            };

            const deleteSetFromCloud = async (setId) => {
                setSyncing(true);
                try {
                    await window.storage.delete(`vocabset:${setId}`, true);
                } catch (error) {
                    console.error('Error deleting:', error);
                }
                setSyncing(false);
            };

            const handleExcelChange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    setExcelFile(file);
                    if (!setName) {
                        setSetName(file.name.replace(/\.(xlsx|xls)$/, ''));
                    }
                }
            };

            const handleAudioChange = (e) => {
                setAudioFiles(Array.from(e.target.files));
            };

            const createVocabSet = async () => {
                if (!setName.trim() || !excelFile || audioFiles.length === 0) {
                    alert('Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin!');
                    return;
                }

                try {
                    const reader = new FileReader();
                    reader.onload = async (e) => {
                        const data = new Uint8Array(e.target.result);
                        const workbook = XLSX.read(data, { type: 'array' });
                        const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                        const jsonData = XLSX.utils.sheet_to_json(firstSheet, { header: 1 });

                        const words = [];
                        for (let i = 1; i < jsonData.length; i++) {
                            const row = jsonData[i];
                            if (row[0]) {
                                const audioFileName = `tu_${String(i).padStart(3, '0')}.wav`;
                                const audioFile = audioFiles.find(f => 
                                    f.name === audioFileName || f.name === audioFileName.replace('.wav', '.mp3')
                                );
                                
                                let audioDataUrl = null;
                                if (audioFile) {
                                    const audioReader = new FileReader();
                                    audioDataUrl = await new Promise((resolve) => {
                                        audioReader.onload = (e) => resolve(e.target.result);
                                        audioReader.readAsDataURL(audioFile);
                                    });
                                }

                                words.push({
                                    id: i,
                                    english: row[1] || '',
                                    pos: row[2] || '',
                                    pronunciation: row[3] || '',
                                    vietnamese: row[4] || '',
                                    audioData: audioDataUrl
                                });
                            }
                        }

                        const newSet = {
                            id: Date.now(),
                            name: setName.trim(),
                            words: words,
                            createdAt: new Date().toISOString()
                        };

                        await saveSetToCloud(newSet);
                        setVocabSets(prev => [newSet, ...prev]);
                        setActiveSetId(newSet.id);
                        setCurrentIndex(0);
                        
                        setSetName('');
                        setExcelFile(null);
                        setAudioFiles([]);
                        setShowUpload(false);
                    };
                    reader.readAsArrayBuffer(excelFile);
                } catch (error) {
                    alert('C√≥ l·ªói x·∫£y ra: ' + error.message);
                }
            };

            const deleteSet = async (setId) => {
                if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a b·ªô t·ª´ n√†y?')) {
                    await deleteSetFromCloud(setId);
                    setVocabSets(prev => prev.filter(s => s.id !== setId));
                    if (activeSetId === setId) {
                        setActiveSetId(null);
                    }
                }
            };

            const selectSet = (setId) => {
                setActiveSetId(setId);
                setCurrentIndex(0);
                setIsFlipped(false);
                setShowUpload(false);
            };

            const prevWord = () => {
                if (currentIndex > 0) {
                    setCurrentIndex(currentIndex - 1);
                    setIsFlipped(false);
                }
            };

            const nextWord = () => {
                const activeSet = vocabSets.find(s => s.id === activeSetId);
                if (activeSet && currentIndex < activeSet.words.length - 1) {
                    setCurrentIndex(currentIndex + 1);
                    setIsFlipped(false);
                }
            };

            const playAudio = () => {
                const activeSet = vocabSets.find(s => s.id === activeSetId);
                const word = activeSet?.words[currentIndex];
                
                if (word?.audioData) {
                    audioRef.current.src = word.audioData;
                    audioRef.current.play();
                } else {
                    alert('Kh√¥ng c√≥ file √¢m thanh!');
                }
            };

            const activeSet = vocabSets.find(s => s.id === activeSetId);
            const currentWord = activeSet?.words[currentIndex];

            if (loading) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-purple-600 via-purple-700 to-indigo-800 flex items-center justify-center">
                        <div className="text-white text-2xl font-semibold animate-pulse">
                            ƒêang t·∫£i d·ªØ li·ªáu t·ª´ cloud...
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gradient-to-br from-purple-600 via-purple-700 to-indigo-800 p-4 md:p-8">
                    {/* Header */}
                    <div className="text-center text-white mb-12 animate-fade-in">
                        <div className="flex items-center justify-center gap-4 mb-4">
                            <BookOpen className="w-12 h-12 animate-bounce" />
                            <h1 className="text-5xl font-bold">H·ªçc T·ª´ V·ª±ng</h1>
                        </div>
                        <p className="text-xl opacity-95">Ph∆∞∆°ng ph√°p h·ªçc hi·ªáu qu·∫£ v·ªõi Flashcard - ƒê·ªìng b·ªô m·ªçi thi·∫øt b·ªã</p>
                        {syncing && (
                            <div className="mt-2 text-sm bg-white/20 inline-block px-4 py-1 rounded-full">
                                ‚òÅÔ∏è ƒêang ƒë·ªìng b·ªô...
                            </div>
                        )}
                    </div>

                    <div className="max-w-6xl mx-auto">
                        {showUpload && (
                            <div className="bg-white/95 backdrop-blur-lg rounded-3xl p-8 mb-6 shadow-2xl animate-slide-up">
                                <div className="text-center mb-8">
                                    <h2 className="text-3xl font-bold text-gray-800 mb-2">‚ú® T·∫°o B·ªô T·ª´ M·ªõi</h2>
                                    <p className="text-gray-600">Upload file Excel v√† audio ƒë·ªÉ b·∫Øt ƒë·∫ßu</p>
                                </div>

                                <div className="space-y-6">
                                    <div>
                                        <label className="block text-gray-700 font-semibold mb-2">üìù T√™n b·ªô t·ª´</label>
                                        <input
                                            type="text"
                                            value={setName}
                                            onChange={(e) => setSetName(e.target.value)}
                                            className="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-purple-500 focus:outline-none transition-all"
                                            placeholder="V√≠ d·ª•: TOEIC 600, IELTS Vocabulary..."
                                        />
                                    </div>

                                    <div className="grid md:grid-cols-2 gap-4">
                                        <div className="border-3 border-dashed border-gray-300 rounded-xl p-6 text-center hover:border-purple-500 transition-all cursor-pointer">
                                            <input
                                                type="file"
                                                accept=".xlsx,.xls"
                                                onChange={handleExcelChange}
                                                className="hidden"
                                                id="excel-upload"
                                            />
                                            <label htmlFor="excel-upload" className="cursor-pointer block">
                                                <Upload className="w-12 h-12 mx-auto mb-3 text-gray-400" />
                                                <div className="font-semibold text-gray-700">File Excel</div>
                                                <div className="text-sm text-purple-600 mt-2">
                                                    {excelFile ? excelFile.name : 'Ch·ªçn file Excel'}
                                                </div>
                                            </label>
                                        </div>

                                        <div className="border-3 border-dashed border-gray-300 rounded-xl p-6 text-center hover:border-purple-500 transition-all cursor-pointer">
                                            <input
                                                type="file"
                                                accept=".wav,.mp3"
                                                multiple
                                                onChange={handleAudioChange}
                                                className="hidden"
                                                id="audio-upload"
                                            />
                                            <label htmlFor="audio-upload" className="cursor-pointer block">
                                                <Volume2 className="w-12 h-12 mx-auto mb-3 text-gray-400" />
                                                <div className="font-semibold text-gray-700">File Audio</div>
                                                <div className="text-sm text-purple-600 mt-2">
                                                    {audioFiles.length > 0 ? `${audioFiles.length} files` : 'Ch·ªçn file audio'}
                                                </div>
                                            </label>
                                        </div>
                                    </div>

                                    <div className="flex gap-3">
                                        <button
                                            onClick={createVocabSet}
                                            className="flex-1 bg-gradient-to-r from-purple-600 to-indigo-600 text-white py-4 rounded-xl font-semibold hover:shadow-xl transition-all flex items-center justify-center gap-2"
                                        >
                                            <Sparkles className="w-5 h-5" />
                                            T·∫°o B·ªô T·ª´ Ngay
                                        </button>
                                        <button
                                            onClick={() => setShowUpload(false)}
                                            className="px-6 py-4 border-2 border-gray-300 rounded-xl hover:bg-gray-100 transition-all"
                                        >
                                            H·ªßy
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {vocabSets.length > 0 && !showUpload && (
                            <div className="bg-white/95 backdrop-blur-lg rounded-3xl p-8 mb-6 shadow-2xl">
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-2xl font-bold text-gray-800">üìñ B·ªô T·ª´ C·ªßa B·∫°n</h2>
                                    <button
                                        onClick={() => setShowUpload(true)}
                                        className="flex items-center gap-2 bg-purple-600 text-white px-4 py-2 rounded-xl hover:bg-purple-700 transition-all"
                                    >
                                        <Plus className="w-5 h-5" />
                                        Th√™m B·ªô M·ªõi
                                    </button>
                                </div>
                                
                                <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-4">
                                    {vocabSets.map(set => (
                                        <div
                                            key={set.id}
                                            onClick={() => selectSet(set.id)}
                                            className={`p-6 rounded-xl border-2 cursor-pointer transition-all hover:shadow-lg ${
                                                set.id === activeSetId
                                                    ? 'border-purple-500 bg-purple-50'
                                                    : 'border-gray-200 hover:border-purple-300'
                                            }`}
                                        >
                                            <div className="flex justify-between items-start mb-2">
                                                <h3 className="font-bold text-lg text-gray-800">{set.name}</h3>
                                                <button
                                                    onClick={(e) => {
                                                        e.stopPropagation();
                                                        deleteSet(set.id);
                                                    }}
                                                    className="text-red-500 hover:bg-red-100 p-2 rounded-lg transition-all"
                                                >
                                                    <Trash2 className="w-4 h-4" />
                                                </button>
                                            </div>
                                            <p className="text-gray-600">{set.words.length} t·ª´ v·ª±ng</p>
                                            <p className="text-xs text-gray-400 mt-1">‚òÅÔ∏è ƒê·ªìng b·ªô cloud</p>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {activeSetId && currentWord && (
                            <div className="space-y-6 animate-slide-up">
                                <div className="perspective-1000">
                                    <div
                                        onClick={() => setIsFlipped(!isFlipped)}
                                        className={`relative w-full h-96 cursor-pointer transition-transform duration-500 transform-style-3d ${
                                            isFlipped ? 'rotate-y-180' : ''
                                        }`}
                                    >
                                        <div className="absolute w-full h-full backface-hidden bg-gradient-to-br from-purple-600 to-indigo-700 rounded-3xl shadow-2xl flex flex-col items-center justify-center p-8 text-white">
                                            <div className="text-6xl font-bold mb-4">{currentWord.english}</div>
                                            {currentWord.pos && (
                                                <div className="text-xl opacity-90 mb-2">{currentWord.pos}</div>
                                            )}
                                            {currentWord.pronunciation && (
                                                <div className="text-lg italic opacity-85 mb-6">{currentWord.pronunciation}</div>
                                            )}
                                            <div className="text-lg opacity-90 animate-pulse">üëÜ Nh·∫•n ƒë·ªÉ xem nghƒ©a</div>
                                        </div>

                                        <div className="absolute w-full h-full backface-hidden rotate-y-180 bg-gradient-to-br from-pink-500 to-rose-600 rounded-3xl shadow-2xl flex flex-col items-center justify-center p-8 text-white">
                                            <div className="text-4xl font-bold mb-4">{currentWord.english}</div>
                                            {currentWord.pos && (
                                                <div className="text-xl opacity-90 mb-2">{currentWord.pos}</div>
                                            )}
                                            {currentWord.pronunciation && (
                                                <div className="text-lg italic opacity-85 mb-6">{currentWord.pronunciation}</div>
                                            )}
                                            <div className="text-3xl font-semibold mb-6">{currentWord.vietnamese}</div>
                                        </div>
                                    </div>
                                </div>

                                <div className="bg-white/95 backdrop-blur-lg rounded-3xl p-6 shadow-xl">
                                    <div className="flex items-center justify-between">
                                        <button
                                            onClick={prevWord}
                                            disabled={currentIndex === 0}
                                            className="flex items-center gap-2 px-6 py-3 bg-gray-100 rounded-xl hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed transition-all"
                                        >
                                            <ChevronLeft className="w-5 h-5" />
                                            <span className="font-semibold hidden sm:inline">Tr∆∞·ªõc</span>
                                        </button>

                                        <div className="flex flex-col items-center gap-3">
                                            <div className="bg-purple-100 text-purple-700 font-bold px-6 py-2 rounded-full text-lg">
                                                {currentIndex + 1} / {activeSet.words.length}
                                            </div>
                                            <button
                                                onClick={playAudio}
                                                className="flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-blue-500 to-cyan-500 text-white rounded-xl hover:shadow-lg transition-all"
                                            >
                                                <Volume2 className="w-5 h-5" />
                                                <span className="font-semibold">Ph√°t √Çm</span>
                                            </button>
                                        </div>

                                        <button
                                            onClick={nextWord}
                                            disabled={currentIndex === activeSet.words.length - 1}
                                            className="flex items-center gap-2 px-6 py-3 bg-gray-100 rounded-xl hover:bg-gray-200 disabled:opacity-50 disabled:cursor-not-allowed transition-all"
                                        >
                                            <span className="font-semibold hidden sm:inline">Sau</span>
                                            <ChevronRight className="w-5 h-5" />
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {vocabSets.length === 0 && !showUpload && (
                            <div className="bg-white/95 backdrop-blur-lg rounded-3xl p-12 text-center shadow-2xl animate-fade-in">
                                <BookOpen className="w-24 h-24 mx-auto mb-6 text-purple-600 animate-bounce" />
                                <h3 className="text-3xl font-bold text-gray-800 mb-4">Ch∆∞a C√≥ B·ªô T·ª´ N√†o</h3>
                                <p className="text-gray-600 text-lg mb-8 max-w-md mx-auto">
                                    H√£y t·∫°o b·ªô t·ª´ ƒë·∫ßu ti√™n c·ªßa b·∫°n ƒë·ªÉ b·∫Øt ƒë·∫ßu h√†nh tr√¨nh h·ªçc ti·∫øng Anh. 
                                    D·ªØ li·ªáu s·∫Ω ƒë∆∞·ª£c l∆∞u tr√™n cloud v√† ƒë·ªìng b·ªô tr√™n m·ªçi thi·∫øt b·ªã!
                                </p>
                                <button
                                    onClick={() => setShowUpload(true)}
                                    className="inline-flex items-center gap-3 bg-gradient-to-r from-purple-600 to-indigo-600 text-white px-8 py-4 rounded-xl text-lg font-semibold hover:shadow-xl transition-all"
                                >
                                    <Sparkles className="w-6 h-6" />
                                    B·∫Øt ƒê·∫ßu Ngay
                                </button>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        ReactDOM.render(<VocabApp />, document.getElementById('root'));
    </script>
</body>
</html>